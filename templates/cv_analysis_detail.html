{% extends "base.html" %}

{% block title %}CV Analysis Results - Ez2source{% endblock %}

{% block content %}
<div class="container">
    <!-- Header Section -->
    <div class="row mb-4">
        <div class="col-12">
            <div class="d-flex justify-content-between align-items-center">
                <div>
                    <h1 class="h3 mb-0">CV Analysis Results</h1>
                    <nav aria-label="breadcrumb">
                        <ol class="breadcrumb">
                            <li class="breadcrumb-item"><a href="{{ url_for('dashboard') }}">Dashboard</a></li>
                            <li class="breadcrumb-item"><a href="{{ url_for('cv_checker') }}">CV Checker</a></li>
                            <li class="breadcrumb-item active" aria-current="page">Analysis Results</li>
                        </ol>
                    </nav>
                </div>
                <div>
                    <a href="{{ url_for('cv_checker') }}" class="btn btn-outline-primary me-2">
                        <i data-feather="arrow-left" class="me-1"></i>Back to CV Checker
                    </a>
                    <button onclick="window.print()" class="btn btn-success">
                        <i data-feather="printer" class="me-1"></i>Print Report
                    </button>
                </div>
            </div>
        </div>
    </div>

    <style>
        .score-circle {
            width: 150px;
            height: 150px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 2.5rem;
            font-weight: bold;
            color: white;
            margin: 0 auto 20px;
        }
        .score-excellent { background: linear-gradient(135deg, #28a745, #20c997); }
        .score-good { background: linear-gradient(135deg, #007bff, #6610f2); }
        .score-fair { background: linear-gradient(135deg, #ffc107, #fd7e14); }
        .score-poor { background: linear-gradient(135deg, #dc3545, #e83e8c); }
        
        .metric-card {
            transition: all 0.3s ease;
            border: 1px solid #dee2e6;
        }
        .metric-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        }
        
        .progress-bar-custom {
            height: 8px;
            border-radius: 10px;
        }
        
        .recommendation-card {
            border-left: 4px solid #007bff;
            background: #f8f9fa;
        }
        
        @media print {
            .btn { display: none; }
        }
    </style>

                <!-- Overall Score Section -->
                <div class="row mb-4">
                    <div class="col-md-4">
                        <div class="card h-100 text-center">
                            <div class="card-body">
                                <h3 class="card-title mb-3">Overall CV Score</h3>
                                <div class="score-circle score-{% if analysis.overall_score >= 80 %}excellent{% elif analysis.overall_score >= 60 %}good{% elif analysis.overall_score >= 40 %}fair{% else %}poor{% endif %}">
                                    {{ analysis.overall_score }}
                                </div>
                                <h4 class="mb-2">
                                    {% if analysis.overall_score >= 80 %}Excellent CV{% elif analysis.overall_score >= 60 %}Good CV{% elif analysis.overall_score >= 40 %}Fair CV{% else %}Needs Improvement{% endif %}
                                </h4>
                                <p class="text-muted">
                                    Analyzed on {{ analysis.analyzed_at.strftime('%B %d, %Y at %I:%M %p') }}
                                </p>
                            </div>
                        </div>
                    </div>
                    
                    <div class="col-md-8">
                        <div class="card h-100">
                            <div class="card-header">
                                <h5 class="mb-0">Score Breakdown</h5>
                            </div>
                            <div class="card-body">
                                <div class="row">
                                    <div class="col-md-6 mb-4">
                                        <div class="d-flex justify-content-between mb-2">
                                            <span class="fw-semibold">Format & Structure</span>
                                            <span class="badge bg-primary">{{ analysis.format_score }}/100</span>
                                        </div>
                                        <div class="progress progress-bar-custom">
                                            <div class="progress-bar bg-primary" style="width: {{ analysis.format_score }}%"></div>
                                        </div>
                                    </div>
                                    
                                    <div class="col-md-6 mb-4">
                                        <div class="d-flex justify-content-between mb-2">
                                            <span class="fw-semibold">Content Quality</span>
                                            <span class="badge bg-success">{{ analysis.content_score }}/100</span>
                                        </div>
                                        <div class="progress progress-bar-custom">
                                            <div class="progress-bar bg-success" style="width: {{ analysis.content_score }}%"></div>
                                        </div>
                                    </div>
                                    
                                    <div class="col-md-6 mb-4">
                                        <div class="d-flex justify-content-between mb-2">
                                            <span class="fw-semibold">Sections & Organization</span>
                                            <span class="badge bg-warning">{{ analysis.sections_score }}/100</span>
                                        </div>
                                        <div class="progress progress-bar-custom">
                                            <div class="progress-bar bg-warning" style="width: {{ analysis.sections_score }}%"></div>
                                        </div>
                                    </div>
                                    
                                    <div class="col-md-6 mb-4">
                                        <div class="d-flex justify-content-between mb-2">
                                            <span class="fw-semibold">Professional Style</span>
                                            <span class="badge" style="background-color: #6f42c1;">{{ analysis.style_score }}/100</span>
                                        </div>
                                        <div class="progress progress-bar-custom">
                                            <div class="progress-bar" style="background-color: #6f42c1; width: {{ analysis.style_score }}%"></div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Detailed Analysis -->
                <div class="row">
                    <div class="col-lg-8">
                        <!-- Strengths -->
                        <div class="card mb-4">
                            <div class="card-header">
                                <h5 class="mb-0 text-success">
                                    <i data-feather="thumbs-up" class="me-2"></i>Strengths
                                </h5>
                            </div>
                            <div class="card-body">
                                {% if analysis.strengths %}
                                    <ul class="list-unstyled">
                                        {% for strength in analysis.strengths %}
                                            <li class="mb-2">
                                                <i data-feather="check-circle" class="text-success me-2"></i>
                                                {{ strength }}
                                            </li>
                                        {% endfor %}
                                    </ul>
                                {% else %}
                                    <p class="text-muted">No specific strengths identified. Consider enhancing your CV content.</p>
                                {% endif %}
                            </div>
                        </div>

                        <!-- Weaknesses -->
                        <div class="card mb-4">
                            <div class="card-header">
                                <h5 class="mb-0 text-danger">
                                    <i data-feather="alert-triangle" class="me-2"></i>Areas for Improvement
                                </h5>
                            </div>
                            <div class="card-body">
                                {% if analysis.weaknesses %}
                                    <ul class="list-unstyled">
                                        {% for weakness in analysis.weaknesses %}
                                            <li class="mb-2">
                                                <i data-feather="x-circle" class="text-danger me-2"></i>
                                                {{ weakness }}
                                            </li>
                                        {% endfor %}
                                    </ul>
                                {% else %}
                                    <p class="text-muted">No major weaknesses identified. Your CV appears to be well-structured.</p>
                                {% endif %}
                            </div>
                        </div>

                        <!-- Key Insights -->
                        <div class="card mb-4">
                            <div class="card-header">
                                <h5 class="mb-0 text-info">
                                    <i data-feather="lightbulb" class="me-2"></i>Key Insights
                                </h5>
                            </div>
                            <div class="card-body">
                                <div class="row">
                                    <div class="col-md-6">
                                        <h6>Document Quality</h6>
                                        <p class="text-muted mb-3">Your CV demonstrates {{ 'excellent' if analysis.overall_score >= 80 else 'good' if analysis.overall_score >= 60 else 'fair' if analysis.overall_score >= 40 else 'basic' }} professional presentation standards.</p>
                                    </div>
                                    <div class="col-md-6">
                                        <h6>Competitive Edge</h6>
                                        <p class="text-muted mb-3">Your CV scores in the {{ 'top 20%' if analysis.overall_score >= 80 else 'top 40%' if analysis.overall_score >= 60 else 'middle 50%' if analysis.overall_score >= 40 else 'bottom 30%' }} of analyzed CVs.</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="col-lg-4">
                        <!-- Recommendations -->
                        <div class="card mb-4">
                            <div class="card-header">
                                <h5 class="mb-0">
                                    <i data-feather="target" class="me-2"></i>Recommendations
                                </h5>
                            </div>
                            <div class="card-body">
                                {% if analysis.recommendations %}
                                    {% for recommendation in analysis.recommendations %}
                                        <div class="recommendation-card p-3 mb-3 rounded">
                                            <h6 class="mb-2">{{ loop.index }}. Priority Action</h6>
                                            <p class="mb-0 small">{{ recommendation }}</p>
                                        </div>
                                    {% endfor %}
                                {% else %}
                                    <div class="recommendation-card p-3 rounded">
                                        <h6 class="mb-2">General Advice</h6>
                                        <p class="mb-0 small">Continue maintaining your CV quality and keep it updated with recent achievements.</p>
                                    </div>
                                {% endif %}
                            </div>
                        </div>

                        <!-- Quick Actions -->
                        <div class="card">
                            <div class="card-header">
                                <h5 class="mb-0">
                                    <i data-feather="zap" class="me-2"></i>Quick Actions
                                </h5>
                            </div>
                            <div class="card-body">
                                <div class="d-grid gap-2">
                                    <a href="{{ url_for('cv_checker') }}" class="btn btn-primary">
                                        <i data-feather="refresh-cw" class="me-2"></i>Analyze Updated CV
                                    </a>
                                    <a href="{{ url_for('candidate_profile', user_id=current_user.id) }}" class="btn btn-outline-primary">
                                        <i data-feather="user" class="me-2"></i>Update Profile
                                    </a>
                                    <button onclick="window.print()" class="btn btn-outline-success">
                                        <i data-feather="download" class="me-2"></i>Save as PDF
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Analysis Summary -->
                <div class="card mt-4">
                    <div class="card-header">
                        <h5 class="mb-0">
                            <i data-feather="file-text" class="me-2"></i>Analysis Summary
                        </h5>
                    </div>
                    <div class="card-body">
                        <div class="row">
                            <div class="col-md-3 text-center">
                                <h2 class="text-primary mb-1">{{ analysis.overall_score }}</h2>
                                <p class="text-muted">Overall Score</p>
                            </div>
                            <div class="col-md-3 text-center">
                                <h2 class="text-success mb-1">{{ analysis.strengths|length if analysis.strengths else 0 }}</h2>
                                <p class="text-muted">Strengths</p>
                            </div>
                            <div class="col-md-3 text-center">
                                <h2 class="text-warning mb-1">{{ analysis.weaknesses|length if analysis.weaknesses else 0 }}</h2>
                                <p class="text-muted">Improvements</p>
                            </div>
                            <div class="col-md-3 text-center">
                                <h2 class="text-info mb-1">{{ analysis.recommendations|length if analysis.recommendations else 0 }}</h2>
                                <p class="text-muted">Recommendations</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}